<!DOCTYPE html>
<html lang="de">

    <%- include("./partials/head.ejs") %>

<body style="background-color: #fff;">

    <form id="form" class="formElement">
        <ul>
            <li>
                <div class="container">                
                    <div class="dropdown">
                        <div class="select">
                        <span class=".span">Kategorie </span>
                        <T style="float: right">⮟</T>
                        <i class="fa fa-chevron-left"></i>
                        </div>
                        <input type="hidden" name="category">
                        <ul class="dropdown-menu">
                        <li id="Microsoft">Microsoft</li>
                        <li id="Adobe">Adobe</li>
                        <li id="Windows">Windows</li>
                        </ul>
                    </div>
                </div>
            </li>
            <li>
                <div class="container">                
                    <div class="dropdown">
                        <div class="select">
                        <span class=".span">User </span>
                        <T style="float: right">⮟</T>
                        <i class="fa fa-chevron-left"></i>
                        </div>
                        <input type="hidden" name="user">
                        <ul class="dropdown-menu">
                        <% if (users.length > 0) { %>
                            <% users.forEach(user => { %>
                                <li id="<%= user._id %>"><%= user.username %></li>
                            <% }) %> 
                        <% } %>
                        </ul>
                    </div>
                </div>
            </li>
            <li>
                <div class="container">                
                    <div class="dropdown">
                        <div class="select">
                        <span class=".span">Hardware - Inventurnummer </span>
                        <T style="float: right">⮟</T>
                        <i class="fa fa-chevron-left"></i>
                        </div>
                        <input type="hidden" name="hardware">
                        <ul class="dropdown-menu">
                        <% if (tracker.length > 0) { %>
                            <% tracker.forEach(tracker => { %>
                                <li id="<%= tracker._id %>"><%= tracker.inventory %></li>
                            <% }) %> 
                        <% } %>
                        </ul>
                    </div>
                </div>
            </li>
            <li><input placeholder="Name: " type="text" name="name" required class="create_input" class="create_input_name"></li>
            <li><input placeholder="Startpunkt: " type="date" id="start" name="start" class="create_input"></li>
            <li><input placeholder="Ablaufsdatum: " type="date" id="end" name="end" class="create_input"></li>
            <li><input placeholder="Information: " type="text" id="info" name="info" class="create_input" class="create_input_information"></li>
            <li><input placeholder="Anmerkungen: " type="text" id="notes" name="notes" class="create_input" class="create_input_notes"></li>
            <li><input placeholder="Notzien: " type="text" id="memo" name="memo" class="create_input" class="create_input_memo"></li>
            <a class="btnCreate"><img alt="edit" src="/img/icons/bearbeiten.png"></a>
        </ul>
    </form>

</body>

<script>
    /*Dropdown Menu*/
    $('.dropdown').click(function () {
            $(this).attr('tabindex', 1).focus();
            $(this).toggleClass('active');
            $(this).find('.dropdown-menu').slideToggle(300);
        });
        $('.dropdown').focusout(function () {
            $(this).removeClass('active');
            $(this).find('.dropdown-menu').slideUp(300);
        });
        $('.dropdown .dropdown-menu li').click(function () {
            $(this).parents('.dropdown').find('span').text($(this).text());
            $(this).parents('.dropdown').find('input').attr('value', $(this).attr('id'));
        });
    /*End Dropdown Menu*/

</script>


<script>
    const sender = document.querySelector('a.btnCreate');
    sender.addEventListener('click', (e) => {
        const endpoint = '/software';
        console.log(document.getElementsByClassName("formElement"));
        const data = new URLSearchParams(new FormData(document.getElementById("form")));
        console.log("asdfasdfafdafk jsdakjckljas kljdskl ajklj" + data);
        fetch(endpoint, {
            method: 'POST',
            body: data,
        })
            .then(response => response.json())
            .then(data => top.location.href = data.redirect)
            .catch(err => console.log(err));
    })
</script>


</html>