<!DOCTYPE html>
<html lang="de">

    <%- include("./partials/head.ejs") %>

<body style="background-color: #fff;">

    <form id="form" class="formElement">
        <ul>
            <li>
                <div class="container">                
                    <div class="dropdown">
                        <div class="select">
                        <span>Kategorie </span>
                        <i class="fa fa-chevron-left"></i>
                        </div>
                        <input type="hidden" name="newcat">
                        <ul class="dropdown-menu">
                        <li id="microsoft">Microsoft</li>
                        <li id="adobe">Adobe</li>
                        <li id="windows">Windows</li>
                        </ul>
                    </div>
                
                <span class="msg"></span>
                </div>
            </li>
            <li><input placeholder="Name: " type="text" name="name" required class="create_input" class="create_input_name"></li>
            <li><input placeholder="Startpunkt: " type="date" id="start" name="start" class="create_input"></li>
            <li><input placeholder="Ablaufsdatum: " type="date" id="end" name="end" class="create_input"></li>
            <li><input placeholder="Information: " type="text" id="info" name="info" class="create_input" class="create_input_information"></li>
            <li><input placeholder="Anmerkungen: " type="text" id="notes" name="notes" class="create_input" class="create_input_notes"></li>
            <li><input placeholder="Notzien: " type="text" id="memo" name="memo" class="create_input" class="create_input_memo"></li>
            <a class="btnCreate"><img alt="edit" src="/img/icons/bearbeiten.png"></a>
        </ul>
    </form>

</body>

<script>
    /*Dropdown Menu*/
    $('.dropdown').click(function () {
            $(this).attr('tabindex', 1).focus();
            $(this).toggleClass('active');
            $(this).find('.dropdown-menu').slideToggle(300);
        });
        $('.dropdown').focusout(function () {
            $(this).removeClass('active');
            $(this).find('.dropdown-menu').slideUp(300);
        });
        $('.dropdown .dropdown-menu li').click(function () {
            $(this).parents('.dropdown').find('span').text($(this).text());
            $(this).parents('.dropdown').find('input').attr('value', $(this).attr('id'));
        });
    /*End Dropdown Menu*/


    $('.dropdown-menu li').click(function () {
    var input = '<strong>' + $(this).parents('.dropdown').find('input').val() + '</strong>',
        msg = '<span class="msg">Hidden input value: ';
    $('.msg').html(msg + input + '</span>');
    }); 
</script>


<script>
    const sender = document.querySelector('a.btnCreate');
    sender.addEventListener('click', (e) => {
        const endpoint = '/software';
        console.log(document.getElementsByClassName("formElement"));
        const data = new URLSearchParams(new FormData(document.getElementById("form")));
        console.log("asdfasdfafdafk jsdakjckljas kljdskl ajklj" + data);
        fetch(endpoint, {
            method: 'POST',
            body: data,
        })
            .then(response => response.json())
            .then(data => top.location.href = data.redirect)
            .catch(err => console.log(err));
    })
</script>


</html>